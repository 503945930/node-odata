<!DOCTYPE html>
<html lang="en">
<head>
    <title>node-odata Documentation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="index.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
</head>
<body>
<div id="header">
    <h1>node-odata Documentation</h1>
</div>

    <div id="sidebar">
<ul>
  <li><div><a href="#1">1) 安装</a></div></li>
  <li><div><a href="#2">2) 快速开始</a></div>
  <ul>
    <li><div><a href="#21">2.1 创建服务</a></div></li>
    <li><div><a href="#22">2.2 运行服务</a></div></li>
  </ul></li>
  <li><div><a href="#3">3) 使用服务</a></div>
  <ul>
    <li><div><a href="#31">3.1 新增</a></div></li>
    <li><div><a href="#32">3.2 修改</a></div></li>
    <li><div><a href="#33">3.3 查询</a></div></li>
    <li><div><a href="#34">3.4 删除</a></div></li>
  </ul></li>
  <li><div><a href="#4-odata">4) OData 查询</a></div>
  <ul>
    <li><div><a href="#41-filter">4.1 $filter</a></div></li>
    <li><div><a href="#42-filter">4.2 $filter 进阶</a></div></li>
    <li><div><a href="#43-top">4.3 $top</a></div></li>
    <li><div><a href="#44-skip">4.4 $skip</a></div></li>
    <li><div><a href="#45-orderby">4.5 $orderby</a></div></li>
    <li><div><a href="#46-metadata">4.6 metadata</a></div></li>
  </ul></li>
  <li><div><a href="#5-api">5) API</a></div>
  <ul>
    <li><div><a href="#51-resourcesregister">5.1 resources.register</a></div></li>
    <li><div><a href="#52-functionsregister">5.2 functions.register</a></div></li>
    <li><div><a href="#53-config">5.3 config</a></div></li>
  </ul></li>
  <li><div><a href="#6">6) 进阶指南</a></div>
  <ul>
    <li><div><a href="#61-resource">6.1 构建复杂的 Resource</a></div></li>
    <li><div><a href="#62">6.2 隐藏特定字段</a></div></li>
    <li><div><a href="#63">6.3 权限验证</a></div></li>
    <li><div><a href="#64">6.4 错误处理</a></div></li>
    <li><div><a href="#65">6.5 日志记录</a></div></li>
  </ul></li>
  <li><div><a href="#7-odata">7) 尚未支持的 OData 特性</a></div></li>
</ul>

    </div>
    <div id="content">

<h1>关于 node-odata</h1>
<div class="intro">


<p>node-odata 可以让你创建 REST API, 并能使用 <a href="http://www.odata.org/">OData</a> 协议的查询格式进行数据的筛选. 让你可以更方便的创建 API, 更专注于业务逻辑.</p>

<h2>什么是 OData 协议?</h2>

<p>OData 全称开放数据协议(Open Data Protocol), 是一个用于 web 的数据访问协议. OData 提供了一个统一的 CRUD (create, read, update, and delete) 操作来查询和维护数据集.</p>

<h2>为什么使用 node-odata?</h2>

<p>node-odata 同时结合了 OData 强大的数据查询能力以及 NodeJS 高并发能力的优势, 使开发者能快速的创建一个高性能并支持各种复杂查询的 REST API. </p>

<p>在常规的 REST 框架中, 仅仅提供了 REST 风格的 CRUD 操作. 开发者不的不对每一个资源都手动添加一些公共功能, 如排序/分页等, 甚至在复杂的业务场景中, 开发者不的不一次次根据业务需求制定一些特定的复杂查询, 这都极大的浪费了人力资源. OData数据访问协议很好的解决了这一问题. 它定义了$filter, $orderby, $select等一系列关键字来进行统一的筛选, 排序, 分页等操作. 极大的减轻了开发者的负担, 提高了生产力.</p>

<p>反观 OData 社区, 目前 node-odata 是唯一一款基于 NodeJS 的 OData 实现. 与其它编译型语言的 OData 实现相比, 它运行更加高效, 部署更加方便, 编写更加简单 (最短只需3行代码即可初始化一个 OData 服务).</p>

<h2>当前状态</h2>

<p>node-odata 当前处于测试版中, 它是稳定的但并不完整. node-odata 基于 CoffeeScript 编写. 它目前需要依赖特定数据库: MongoDB. 当前的目标是完成 OData 协议中得所有特性, 然后制作链接到其它数据库的 Adapter.</p>


</div>
<h1 id="1">1) 安装</h1>

<p>node-odata 的运行需要依赖于 <a href="http://nodejs.org/">NodeJS</a> 和 <a href="http://www.mongodb.org/">MongoDB</a>, 在安装了依赖项之后, 运行以下命令即可:</p>

<pre class="shell"><code>npm install node-odata
</code></pre>

<h1 id="2">2) 快速开始</h1>

<p>这里我们讲创建并运行一个最简单的 OData 服务.</p>

<h2 id="21">2.1 创建服务</h2>

<p>安装完成后, 新建 <em>index.js</em> 文件并输入:</p>

<pre><code>var odata = require('node-odata');

odata.set('db', 'mongodb://localhost/my-app');

odata.resources.register({
    url: '/books',
    model: {
        title: String,
        price: Number
    }
});

odata.listen(3000);
</code></pre>

<h2 id="22">2.2 运行服务</h2>

<p>保存后输入以下命令即可启动 OData 服务:</p>

<pre class="shell"><code>node index.js
</code></pre>

<p>它将自动注册以下路由:</p>

<pre><code>GET    /odata/books
GET    /odata/books/:id
POST   /odata/books
PUT    /odata/books/:id
DELETE /odata/books/:id
</code></pre>

<h1 id="3">3) 使用服务</h1>

<p>你可以使用 <a href="http://zh.wikipedia.org/wiki/REST">REST</a> 风格的 HTTP 请求来对资源进行增删查改操作.</p>

<h2 id="31">3.1 新增</h2>

<p>使用 <code>POST /odata/resource</code> 插入新的数据, 他将返回 resource 的最新状态.</p>

<pre class="shell"><code>curl -i -X POST -d '{"title": "title of book", "price": 19.99}' -H "Content-Type: application/json" http://127.0.0.1:3000/odata/books
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8
Content-Length: 97
Date: Sun, 11 Jan 2015 01:46:57 GMT
Connection: keep-alive

{
  "__v": 0,
  "title": "title of book",
  "price": 19.99,
  "_id": "54b1d6117d0b3d6d5255bc30"
}
</code></pre>

<h2 id="32">3.2 修改</h2>

<p>使用 <code>PUT /odata/resource/:id</code> 修改已有的数据, 他将返回 resource 修改后的状态.</p>

<pre class="shell"><code>curl -i -X PUT -d '{"title": "title of book", "price": 9.99}' -H "Content-Type: application/json" http://127.0.0.1:3000/odata/books/54b1d6117d0b3d6d5255bc30
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Content-Length: 96
Date: Sun, 11 Jan 2015 01:50:11 GMT
Connection: keep-alive

{
  "_id": "54b1d6117d0b3d6d5255bc30",
  "title": "title of book",
  "price": 9.99,
  "__v": 0
}
</code></pre>

<h2 id="33">3.3 查询</h2>

<p>使用 <code>GET /odata/resource</code> 查询 resource 列表, 其结果将以数组的形式将返回在 value 对象中.</p>

<pre class="shell"><code>curl -i -X GET http://127.0.0.1:3000/odata/books
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Content-Length: 402
Date: Sun, 11 Jan 2015 01:52:49 GMT
Connection: keep-alive

{
  "value": [
    {
      "_id": "54b1d6117d0b3d6d5255bc30",
      "title": "title of book",
      "price": 9.99,
      "__v": 0
    }
  ]
}
</code></pre>

<p>使用 <code>GET /odata/resource/:id</code> 查询特定 resource.</p>

<pre class="shell"><code>curl -i -X GET http://127.0.0.1:3000/odata/books/54b1d6117d0b3d6d5255bc30
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Content-Length: 96
Date: Sun, 11 Jan 2015 01:54:49 GMT
Connection: keep-alive

{
  "_id": "54b1d6117d0b3d6d5255bc30",
  "title": "title of book",
  "price": 9.99,
  "__v": 0
}
</code></pre>

<h2 id="34">3.4 删除</h2>

<p>使用 <code>DELETE /odata/resource/:id</code> 删除指定 resource.</p>

<pre class="shell"><code>curl -i -X DELETE http://127.0.0.1:3000/odata/books/54b1d6117d0b3d6d5255bc30
HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 2
Date: Sun, 11 Jan 2015 01:56:21 GMT
Connection: keep-alive

OK
</code></pre>

<h1 id="4-odata">4) OData 查询</h1>

<h2 id="41-filter">4.1 $filter</h2>

<h2 id="42-filter">4.2 $filter 进阶</h2>

<h2 id="43-top">4.3 $top</h2>

<h2 id="44-skip">4.4 $skip</h2>

<h2 id="45-orderby">4.5 $orderby</h2>

<h2 id="46-metadata">4.6 metadata</h2>

<h1 id="5-api">5) API</h1>

<h2 id="51-resourcesregister">5.1 resources.register</h2>

<h2 id="52-functionsregister">5.2 functions.register</h2>

<h2 id="53-config">5.3 config</h2>

<h1 id="6">6) 进阶指南</h1>

<h2 id="61-resource">6.1 构建复杂的 Resource</h2>

<h2 id="62">6.2 隐藏特定字段</h2>

<h2 id="63">6.3 权限验证</h2>

<h2 id="64">6.4 错误处理</h2>

<h2 id="65">6.5 日志记录</h2>

<h1 id="7-odata">7) 尚未支持的 OData 特性</h1>

    </div> <!-- #content -->
<script type="text/javascript" charset="utf-8">
$(function() {
    var headerHeight = $("#header").height();

    var sections = $("#content h1[id], #content h2[id]");
    var sectionOffsets = [];
    var slack = 100;  // Give the section scroll some slack (in pixels).
    sections.each(function(elem) {
        sectionOffsets.push($(this).offset().top - headerHeight - slack);
    });

    var currSectionIdx = -1;
    function getSectionIdx(scrollDistance) {
        if (scrollDistance < sectionOffsets[0]) {
            return -1;
        } else {
            for (var id = sectionOffsets.length; id > 0; id--) {
                if (scrollDistance > sectionOffsets[id - 1]) {
                    return id - 1;
                    break;
                }
            }
        }
    }

    /** {{{ http://code.activestate.com/recipes/577787/ (r2) */
    _slugify_strip_re = /[^\w\s-]/g;
    _slugify_hyphenate_re = /[-\s]+/g;
    function slugify(s) {
      s = s.replace(_slugify_strip_re, '').trim().toLowerCase();
      s = s.replace(_slugify_hyphenate_re, '-');
      return s;
    }
    /** end of http://code.activestate.com/recipes/577787/ }}} */

    /* See <https://github.com/trentm/restdown/issues/11>. */
    function safechars(s) {
      return s.replace(_slugify_strip_re, '');
    }

    $("#content").scroll(function() {
        var scrollDistance = $("#content").scrollTop();
        var sectionIdx = getSectionIdx(scrollDistance);

        if (sectionIdx !== currSectionIdx) {
            $("#sidebar li>div").removeClass("current");
            currSectionIdx = sectionIdx;
            if (currSectionIdx >= 0) {
                var heading = $(sections[currSectionIdx]).text();
                var possibleAnchors = [
                    slugify(heading), // h1 or non-method h2
                    heading.replace(/ /g, '-'), // h2 method, just name or just endpoint
                    heading.slice(0, heading.lastIndexOf(' (')).trimRight().replace(/ /g, '-'), // h2 method, name and endpoint
                ];
                for (var i=0; i < possibleAnchors.length; i++) {
                    var anchor = safechars(possibleAnchors[i]);
                    try {
                        $("#sidebar a[href=#" + anchor + "]").parent().addClass("current");
                    } catch (e) {
                        /* Ignore error if no such element. */
                        console.log(e)
                    }
                }
            }
        }
    });
});
</script>

</body>
</html>
